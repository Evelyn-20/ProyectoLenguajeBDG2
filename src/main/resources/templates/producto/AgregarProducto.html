<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
    <head th:replace="~{layout/plantilla :: head}">
        <title>Nous - Agregar Producto</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body class="d-flex flex-column min-vh-100 bg-light">
        <header th:replace="~{layout/plantilla :: header}"></header>

        <section class="py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card shadow-sm rounded-4 border-0">
                            <div class="card-body p-5">
                                <h2 class="text-center mb-5 fw-bold display-6">Agregar Producto</h2>

                                <form th:action="@{/producto/guardar}" th:object="${producto}" 
                                      method="POST" class="needs-validation" enctype="multipart/form-data" novalidate>
                                    <!-- Código -->
                                    <div class="mb-4">
                                        <label for="codigo" class="form-label fw-semibold">Código</label>
                                        <input type="number" class="form-control rounded-3 py-2" 
                                               th:field="*{codigo}" 
                                               id="codigo" 
                                               required
                                               minlength="3"
                                               maxlength="20"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese un código válido (3-20 caracteres)
                                        </div>
                                    </div>

                                    <!-- Nombre -->
                                    <div class="mb-4">
                                        <label for="nombre" class="form-label fw-semibold">Nombre</label>
                                        <input type="text" class="form-control rounded-3 py-2" 
                                               th:field="*{nombre}" 
                                               id="nombre" 
                                               required
                                               minlength="2"
                                               maxlength="100"
                                               placeholder="Nombre del producto"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese un nombre válido
                                        </div>
                                    </div>

                                    <!-- Descripción -->
                                    <div class="mb-4">
                                        <label for="descripcion" class="form-label fw-semibold">Descripción</label>
                                        <textarea class="form-control rounded-3" 
                                                  th:field="*{descripcion}" 
                                                  id="descripcion" 
                                                  rows="3" 
                                                  required
                                                  minlength="10"
                                                  maxlength="500"
                                                  placeholder="Descripción detallada del producto"></textarea>
                                        <div class="invalid-feedback">
                                            Por favor ingrese una descripción válida
                                        </div>
                                    </div>

                                    <!-- Material -->
                                    <div class="mb-4">
                                        <label for="material" class="form-label fw-semibold">Material</label>
                                        <input type="text" class="form-control rounded-3 py-2" 
                                               th:field="*{material}" 
                                               id="material" 
                                               required
                                               minlength="2"
                                               maxlength="50"
                                               placeholder="Ej: Algodón, Poliéster"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese el material
                                        </div>
                                    </div>

                                    <!-- Categoría -->
                                    <div class="mb-4">
                                        <label for="categoriaId" class="form-label fw-semibold">Categoría</label>
                                        <select class="form-select rounded-3 py-2" 
                                                th:field="*{categoriaId}" 
                                                id="categoriaId" 
                                                required>
                                            <option value="">Seleccionar categoría</option>
                                            <option th:each="categoria : ${categorias}" 
                                                    th:value="${categoria.categoriaId}" 
                                                    th:text="${categoria.nombreCategoria}"></option>
                                        </select>
                                        <div class="invalid-feedback">
                                            Por favor seleccione una categoría
                                        </div>
                                    </div>

                                    <!-- Talla -->
                                    <div class="mb-4">
                                        <label for="talla" class="form-label fw-semibold">Talla</label>
                                        <select class="form-select rounded-3 py-2" 
                                                th:field="*{talla}" 
                                                id="talla">
                                            <option value="">Seleccionar talla</option>
                                            <option value="XS">XS</option>
                                            <option value="S">S</option>
                                            <option value="M">M</option>
                                            <option value="L">L</option>
                                            <option value="XL">XL</option>
                                            <option value="XXL">XXL</option>
                                            <option value="Único">Único</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            Por favor seleccione una talla
                                        </div>
                                    </div>

                                    <!-- Color -->
                                    <div class="mb-4">
                                        <label for="color" class="form-label fw-semibold">Color</label>
                                        <input type="text" class="form-control rounded-3 py-2" 
                                               th:field="*{color}" 
                                               id="color" 
                                               required
                                               minlength="2"
                                               maxlength="30"
                                               placeholder="Ej: Rojo, Azul, Negro"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese el color
                                        </div>
                                    </div>

                                    <!-- Precio -->
                                    <div class="mb-4">
                                        <label for="precio" class="form-label fw-semibold">Precio (₡)</label>
                                        <input type="number" class="form-control rounded-3 py-2" 
                                               th:field="*{precio}" 
                                               id="precio" 
                                               required 
                                               min="0.01" 
                                               step="0.01"
                                               placeholder="0.00"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese un precio válido (mayor a 0)
                                        </div>
                                    </div>

                                    <!-- Stock Actual -->
                                    <div class="mb-4">
                                        <label for="stockActual" class="form-label fw-semibold">Stock Actual</label>
                                        <input type="number" class="form-control rounded-3 py-2" 
                                               th:field="*{stockActual}" 
                                               id="stockActual" 
                                               required 
                                               min="0"
                                               placeholder="Cantidad disponible"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese el stock actual
                                        </div>
                                    </div>

                                    <!-- Stock Mínimo -->
                                    <div class="mb-4">
                                        <label for="stockMinimo" class="form-label fw-semibold">Stock Mínimo</label>
                                        <input type="number" class="form-control rounded-3 py-2" 
                                               th:field="*{stockMinimo}" 
                                               id="stockMinimo" 
                                               required 
                                               min="0"
                                               placeholder="Cantidad mínima"/>
                                        <div class="invalid-feedback">
                                            Por favor ingrese el stock mínimo
                                        </div>
                                    </div>

                                    <!-- Imagen del Producto -->
                                    <div class="mb-4">
                                        <label for="imagen" class="form-label fw-semibold">Imagen del Producto</label>
                                        <input class="form-control rounded-3" 
                                               type="file" 
                                               name="imagenFile" 
                                               id="imagen" 
                                               accept="image/*"/>
                                        <div class="form-text">Formatos permitidos: JPG, PNG, GIF (máximo 5MB)</div>
                                        <img id="preview" src="#" alt="Vista previa" 
                                             class="mt-3 rounded-3 d-none" style="max-height: 200px; object-fit: cover;"/>
                                    </div>

                                    <!-- Estado -->
                                    <div class="mb-4">
                                        <div class="form-check">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   th:field="*{activo}" 
                                                   id="activo" 
                                                   checked/>
                                            <label class="form-check-label fw-semibold" for="activo">
                                                Producto Activo
                                            </label>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-dark px-4 py-3 rounded-3 text-white w-100 fw-bold text-uppercase mt-4">
                                        Guardar Producto
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer th:replace="~{layout/plantilla :: footer}"></footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // Validación de Bootstrap
            (function() {
            'use strict';
            window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
            }
            form.classList.add('was-validated');
            }, false);
            });
            }, false);
            })();

            // Vista previa de imagen
            document.getElementById('imagen').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('preview');

            if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('d-none');
            };
            reader.readAsDataURL(file);
            } else {
            preview.classList.add('d-none');
            }
            });
        </script>
    </body>
</html>